import dataclasses
import sympy
import typing
from .codegen.common import index_prevent_reordering as index_prevent_reordering
from .utils import VarRanges as VarRanges, get_dtype_size as get_dtype_size, sympy_product as sympy_product, sympy_str as sympy_str, sympy_subs as sympy_subs, sympy_symbol as sympy_symbol
from .virtualized import V as V
from _typeshed import Incomplete
from typing import Callable, Dict, List, Set, Tuple

log: Incomplete
Dep: Incomplete

class MemoryDep(typing.NamedTuple):
    name: str
    index: sympy.Expr
    size: Tuple[sympy.Expr, ...]
    def broadcast_extend_sizes(self, extra_sizes: List[sympy.Expr]) -> MemoryDep: ...
    def maybe_swap_sizes(self) -> MemoryDep: ...
    def strip_last_size(self) -> MemoryDep: ...
    def rename(self, renames: Dict[str, str]) -> MemoryDep: ...
    def numbytes_hint(self): ...
    def is_contiguous(self) -> bool: ...

class StarDep(typing.NamedTuple):
    name: str
    def rename(self, renames: Dict[str, str]) -> StarDep: ...
    def numbytes_hint(self): ...
    def is_contiguous(self) -> bool: ...

class WeakDep(typing.NamedTuple):
    name: str
    def rename(self, renames: Dict[str, str]) -> WeakDep: ...
    def numbytes_hint(self): ...
    def is_contiguous(self) -> bool: ...

class IndexExprDep(typing.NamedTuple):
    index: sympy.Expr
    size: Tuple[sympy.Expr, ...]

@dataclasses.dataclass
class ReadWrites:
    reads: Set[Dep]
    writes: Set[Dep]
    index_exprs: Set[IndexExprDep]
    range_vars: List[sympy.Expr] | None = ...
    var_ranges: VarRanges | None = ...
    def rename(self, renames: typing.Dict[str, str]) -> ReadWrites: ...
    def with_read(self, dep: Dep) -> ReadWrites: ...
    def merge(self, other): ...
    def remove_reads(self, rem_reads): ...
    def __init__(self, reads, writes, index_exprs, range_vars, var_ranges) -> None: ...

class _RecordLoadStoreInner(V.MockHandler):
    def __init__(self, var_ranges: VarRanges, normalize: bool) -> None: ...
    def canonicalize(self, index: sympy.Expr) -> Tuple[sympy.Expr, Tuple[sympy.Expr, ...]]: ...
    def load(self, name: str, index: sympy.Expr) -> str: ...
    def store(self, name: str, index: sympy.Expr, value: str, mode: Incomplete | None = None) -> str: ...
    def reduction(self, name: str, dtype, src_dtype, reduction_type, index, value) -> str: ...
    def index_expr(self, index: sympy.Expr, dtype) -> str: ...

class RecordLoadStore(V.KernelFormatterHandler):
    def __init__(self, var_ranges: VarRanges, normalize: bool) -> None: ...

def var_builder(prefix: str) -> Tuple[VarRanges, Callable[[sympy.Expr], sympy.Symbol]]: ...
def index_vars_no_squeeze(*argsizes: Tuple[sympy.Expr, ...], prefix: str): ...
def index_vars_squeeze(*argsizes: Tuple[sympy.Expr, ...], prefix: str = 'd'): ...
def extract_read_writes(fn: Callable, *argsizes: Tuple[sympy.Expr, ...], normalize: bool = False, prefix: str = 'd'): ...
def canonicalization_prefix(): ...

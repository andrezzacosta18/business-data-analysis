import abc
import torch
from _typeshed import Incomplete
from torch import Tensor as Tensor
from torch.autograd.profiler import record_function as record_function
from torch.distributed.rpc import RRef as RRef
from torch.distributed.rpc.internal import RPCExecMode as RPCExecMode
from torch.futures import Future as Future
from torch.testing._internal.common_utils import TemporaryFileName as TemporaryFileName
from torch.testing._internal.dist_utils import dist_init as dist_init, get_function_event as get_function_event, initialize_pg as initialize_pg, worker_name as worker_name
from torch.testing._internal.distributed.rpc.rpc_agent_test_fixture import RpcAgentTestFixture as RpcAgentTestFixture
from typing import Dict, List, Tuple

def rref_isinstance(rref, cls_to_check): ...
def sleep(t) -> None: ...
def rpc_return_rref(dst): ...
def rref_local_value(rref: RRef[Tensor]) -> Tensor: ...
def list_create() -> List[int]: ...
def rref_list_mutate(rref: RRef[List[int]]) -> None: ...
def return_value(value: int) -> int: ...

class RRefAPITest:
    def test_rref_is_owner(self): ...
    def test_rref_local_value(self) -> None: ...
    def test_local_rref_local_value(self) -> None: ...
    def test_user_rrefs_confirmed(self) -> None: ...
    def test_user_rrefs_confirmed_remote(self) -> None: ...
    def test_rref_list_mutate(self) -> None: ...

def no_arg(): ...
def one_arg(value): ...
def script_add_ones(x): ...
def script_add_ones_with_record_function(x, block: str): ...
def record_function_on_caller_rpc_async(dst_worker_name: str, block: str) -> Tensor: ...
def script_fork_wait_udf(tensor): ...
def rref_to_here(rref_var: RRef[Tensor]) -> Tensor: ...
def return_rref(rref_var: RRef[Tensor]) -> RRef[Tensor]: ...
def script_raise_func(value): ...
def script_fork_wait_throw(invalue): ...
def call_rpc_with_profiling(record: torch.classes.profiler._RecordFunction, dst_worker_name: str) -> Tensor: ...
def call_rpc_torchscript_with_record_function(dst_worker_name: str, block: str) -> Tensor: ...
def call_fork_with_profiling(record: torch.classes.profiler._RecordFunction) -> Tensor: ...

class MyScriptModuleWithRRefs(torch.jit.ScriptModule):
    rrefs: Incomplete
    def __init__(self, dst_worker) -> None: ...
    def forward(self) -> Tensor: ...

def rref_python_annotation(rref_var: RRef[Tensor]) -> RRef[Tensor]: ...
def rref_script_annotation(rref_var: RRef[Tensor]) -> Tensor: ...

class RRefTypingTest:
    def test_rref_as_arg_and_return(self) -> None: ...
    def test_my_script_module_with_rrefs(self) -> None: ...
    def test_rref_python_annotation(self) -> None: ...

class FutureTypingTest:
    def test_future_passed_between_python_and_jit(self): ...
    def test_future_python_annotation(self): ...

class MyScriptClass:
    a: Incomplete
    def __init__(self, a: int) -> None: ...
    def get_value(self) -> int: ...

class MyModuleInterface(torch.nn.Module):
    def forward(self) -> Tensor: ...

class MyScriptModule(torch.jit.ScriptModule):
    a: Incomplete
    def __init__(self, rank) -> None: ...
    def forward(self) -> Tensor: ...
    def custom_func(self) -> Tensor: ...

def owner_create_rref_my_script_class(a): ...
def owner_create_rref_my_script_module(a): ...
def script_rref_get_value_my_script_class(rref: RRef[MyScriptClass]) -> int: ...
def script_rref_run_forward_my_script_module(rref: RRef[MyModuleInterface]) -> Tensor: ...

class LocalRRefTest:
    def test_create_local_script_class_rref_in_py(self) -> None: ...
    def test_create_local_script_module_rref_in_py(self) -> None: ...
    def test_return_local_script_class_rref_in_py_and_use_in_script(self): ...
    def test_return_local_script_module_rref_in_py_and_use_in_script(self): ...

def python_function(): ...
def two_args_two_kwargs(first_arg, second_arg, first_kwarg=..., second_kwarg=...): ...
def assorted_types_args_kwargs(tensor_arg: Tensor, str_arg: str, int_arg: int, tensor_kwarg: Tensor = ..., str_kwarg: str = 'str_kwarg', int_kwarg: int = 2): ...
def raise_script() -> None: ...
def script_rpc_async_call(dst_worker_name: str, args: Tuple[Tensor, Tensor], kwargs: Dict[str, Tensor]): ...
def script_rpc_sync_call(dst_worker_name: str, args: Tuple[Tensor, Tensor], kwargs: Dict[str, Tensor]): ...
def script_rpc_remote_call(dst_worker_name: str, args: Tuple[Tensor, Tensor], kwargs: Dict[str, Tensor]): ...

class JitRpcOpTest:
    def test_all_kwargs_are_populated_by_defaults(self) -> None: ...
    def test_some_kwargs_are_populated_by_defaults(self) -> None: ...
    def test_no_kwargs_are_populated_by_defaults(self) -> None: ...
    def test_args_and_kwargs_contain_different_types(self): ...
    def test_kwargs_not_passed(self): ...
    def test_args_kwargs_are_neither_passed(self): ...
    def test_less_than_needed_args_are_specified(self): ...
    def test_more_than_needed_args_are_specified(self): ...
    def test_unexepected_kwarg_is_specified(self): ...
    def test_call_python_function_remotely_from_script_not_supported(self): ...
    def test_call_script_function_that_raises_remotely_from_script(self): ...
    def test_call_script_function_that_not_exists_remotely_from_script(self): ...

def my_script_module_init(rank: int) -> MyModuleInterface: ...
def construct_my_script_module(rank: int) -> MyModuleInterface: ...
def run_ref_script_module(ref_script_module: RRef[MyModuleInterface], t: Tensor) -> Tensor: ...
def script_check_rref_confirmed(rref: RRef[Tensor]) -> bool: ...
def save_rref(rref_var: RRef[Tensor], fname: str) -> None: ...
def script_add(x: Tensor, y: Tensor) -> Tensor: ...
def async_add(to: str, x: Tensor, y: Tensor) -> Future[Tensor]: ...
def async_wrong_type() -> Tensor: ...
def load_script_module_with_pickled_rref(pickled_script_module): ...

class JitRpcTest(RRefAPITest, RRefTypingTest, LocalRRefTest, JitRpcOpTest, FutureTypingTest, RpcAgentTestFixture, metaclass=abc.ABCMeta):
    def test_torchscript_function(self) -> None: ...
    def test_torchscript_function_exception(self) -> None: ...
    def test_torchscript_functions_not_supported(self) -> None: ...
    def test_remote_script_module(self) -> None: ...
    def test_create_script_module_on_remote(self) -> None: ...
    def test_load_script_module_with_pickled_rref(self) -> None: ...
    def test_rref_jit_pickle_not_supported(self) -> None: ...
    def test_remote_script_throw(self) -> None: ...
    def test_remote_script_udf(self) -> None: ...
    def test_async_script_udf(self) -> None: ...
    def test_callback_simple(self): ...
    def test_callback_chain(self): ...
    def test_add_done_callback(self): ...
    def test_async_script_throw(self) -> None: ...
    def test_callback_with_exception(self) -> None: ...
    def test_call_rpc_with_profiling(self) -> None: ...
    def test_rpc_async_jit_profiled(self) -> None: ...
    def test_record_function_on_caller_rpc_async(self) -> None: ...
    def test_rpc_torchscript_record_function(self) -> None: ...
    def test_record_function_jit_end_callbacks_with_fork(self) -> None: ...
    def test_call_fork_in_jit_with_profiling(self) -> None: ...
    def test_async_function_simple(self) -> None: ...
    def test_async_function_wrong_return_type(self) -> None: ...
    def test_async_function_wrong_decorator_order(self): ...
    def test_async_function_remote(self) -> None: ...
    def test_async_function_remote_multi(self) -> None: ...
    def test_async_function_wrong_return_type_remote(self) -> None: ...

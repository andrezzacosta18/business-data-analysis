import torch.distributed as dist
from _typeshed import Incomplete
from dataclasses import dataclass
from torch._C._distributed_c10d import AllgatherOptions as AllgatherOptions, AllreduceOptions as AllreduceOptions, BroadcastOptions as BroadcastOptions, ReduceOp as ReduceOp, ReduceScatterOptions as ReduceScatterOptions, ScatterOptions as ScatterOptions, Store as Store
from torch.futures import Future as Future
from torch.utils._pytree import tree_flatten as tree_flatten
from typing import Dict, Tuple

def flatten_list(lst): ...
def ret_work(ret): ...

class AllReduce:
    op: Incomplete
    def __init__(self, op) -> None: ...
    def work(self, data) -> None: ...

class AllGather:
    def work(self, data) -> None: ...

class Scatter:
    src: Incomplete
    def __init__(self, src) -> None: ...
    def work(self, data) -> None: ...

class ReduceScatter:
    op: Incomplete
    def __init__(self, op) -> None: ...
    def work(self, data) -> None: ...

class Broadcast:
    src: Incomplete
    def __init__(self, src) -> None: ...
    def work(self, data) -> None: ...

class Collective:
    def __init__(self, world_size, collective, pg) -> None: ...
    def join(self, rank, data): ...

class ProcessLocalGroup(dist.ProcessGroup):
    @classmethod
    def exception_handle(cls, exc) -> None: ...
    @classmethod
    def reset(cls) -> None: ...
    def allreduce(self, tensor_list, opts=...): ...
    def allgather(self, output_tensors, input_tensor, opts=...): ...
    def broadcast(self, tensor_list, opts=...): ...
    def scatter(self, output_tensors, input_tensors, opts=...): ...
    def reduce_scatter(self, output_tensor, scatter_list, opts=...): ...
    def __init__(self, rank, world_size) -> None: ...
    def size(self): ...
    @property
    def pg_name(self):
        """
        return the global registered name of the current pg in the world
        """
    def getBackendName(self): ...

@dataclass
class WorldData:
    default_pg: dist.ProcessGroup
    pg_map: Dict[dist.ProcessGroup, Tuple[str, Store | None]]
    pg_names: Dict[dist.ProcessGroup, str]
    pg_group_ranks: Dict[dist.ProcessGroup, Dict[int, int]]
    pg_backend_config: Dict[dist.ProcessGroup, str]
    group_count: int
    def __init__(self, default_pg, pg_map, pg_names, pg_group_ranks, pg_backend_config, group_count) -> None: ...

class ThreadLocalWorld:
    @property
    def default_pg(self): ...
    @default_pg.setter
    def default_pg(self, value) -> None: ...
    @property
    def pg_map(self): ...
    @property
    def pg_names(self): ...
    @property
    def pg_group_ranks(self): ...
    @property
    def pg_backend_config(self): ...
    @property
    def group_count(self) -> int: ...
    @group_count.setter
    def group_count(self, value) -> None: ...

import torch
from .symbolic_shapes import SymDispatchMode
from _typeshed import Incomplete
from collections.abc import Generator
from dataclasses import dataclass
from torch.fx import GraphModule, Proxy, Tracer
from torch.utils._python_dispatch import TorchDispatchMode
from typing import Any, Callable, Dict, Tuple

__all__ = ['PythonKeyTracer', 'dispatch_trace', 'make_fx', 'DecompositionInterpreter', 'py_sym_types', 'get_innermost_proxy_mode']

py_sym_types: Incomplete

@dataclass
class _ProxyTensor:
    proxy: Proxy
    constant: torch.Tensor | None
    def __init__(self, proxy, constant) -> None: ...

class PythonKeyTracer(Tracer):
    tensor_tracker: Incomplete
    symnode_tracker: Incomplete
    def __init__(self) -> None: ...
    def call_module(self, m: torch.nn.Module, forward: Callable[..., Any], args: Tuple[Any, ...], kwargs: Dict[str, Any]) -> Any: ...
    def getattr(self, attr, attr_val, parameter_proxy_cache): ...
    def create_arg(self, a: Any): ...

def dispatch_trace(root: torch.nn.Module | Callable, tracer: Tracer, concrete_args: Tuple[Any, ...] | None = None) -> GraphModule: ...

class ProxyTorchDispatchMode(TorchDispatchMode):
    tracer: Incomplete
    tracing_mode: Incomplete
    enable_tracing: bool
    sym_mode: Incomplete
    trace_state: Incomplete
    def __init__(self, tracer, tracing_mode) -> None: ...
    def __torch_dispatch__(self, func, types, args=(), kwargs: Incomplete | None = None): ...
    def __enter__(self): ...
    def __exit__(self, exc_type: type[BaseException] | None, exc_value: BaseException | None, traceback: types.TracebackType | None): ...
    def inner_torch_dispatch(self, func, types, args=(), kwargs: Incomplete | None = None): ...

class ProxySymDispatchMode(SymDispatchMode):
    tracer: Incomplete
    enable_tracing: bool
    def __init__(self, tracer) -> None: ...
    def enable(self, b) -> Generator[None, None, None]: ...
    def __sym_dispatch__(self, func, types, args, kwargs): ...

class DecompositionInterpreter(torch.fx.Interpreter):
    new_graph: Incomplete
    tracer: Incomplete
    decomposition_table: Incomplete
    mode: Incomplete
    def __init__(self, module: torch.fx.GraphModule, new_graph: torch.fx.Graph, decomposition_table: Incomplete | None = None, **kwargs) -> None: ...
    def placeholder(self, target, args, kwargs): ...
    def get_attr(self, target, args, kwargs): ...
    def output(self, target, args, kwargs): ...
    def run(self, *args, **kwargs): ...

def make_fx(f, decomposition_table: Incomplete | None = None, tracing_mode: str = 'real', _allow_non_fake_inputs: bool = False): ...
def get_innermost_proxy_mode(): ...

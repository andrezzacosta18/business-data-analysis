from _typeshed import Incomplete
from collections.abc import Generator
from nltk.grammar import Nonterminal as Nonterminal, PCFG as PCFG
from nltk.parse.api import ParserI as ParserI
from nltk.parse.chart import AbstractChartRule as AbstractChartRule, Chart as Chart, LeafEdge as LeafEdge, TreeEdge as TreeEdge
from nltk.tree import ProbabilisticTree as ProbabilisticTree, Tree as Tree

class ProbabilisticLeafEdge(LeafEdge):
    def prob(self): ...

class ProbabilisticTreeEdge(TreeEdge):
    def __init__(self, prob, *args, **kwargs) -> None: ...
    def prob(self): ...
    @staticmethod
    def from_production(production, index, p): ...

class ProbabilisticBottomUpInitRule(AbstractChartRule):
    NUM_EDGES: int
    def apply(self, chart, grammar) -> Generator[Incomplete, None, None]: ...

class ProbabilisticBottomUpPredictRule(AbstractChartRule):
    NUM_EDGES: int
    def apply(self, chart, grammar, edge) -> Generator[Incomplete, None, None]: ...

class ProbabilisticFundamentalRule(AbstractChartRule):
    NUM_EDGES: int
    def apply(self, chart, grammar, left_edge, right_edge) -> Generator[Incomplete, None, None]: ...

class SingleEdgeProbabilisticFundamentalRule(AbstractChartRule):
    NUM_EDGES: int
    def apply(self, chart, grammar, edge1) -> Generator[Incomplete, Incomplete, None]: ...

class BottomUpProbabilisticChartParser(ParserI):
    """
    An abstract bottom-up parser for ``PCFG`` grammars that uses a ``Chart`` to
    record partial results.  ``BottomUpProbabilisticChartParser`` maintains
    a queue of edges that can be added to the chart.  This queue is
    initialized with edges for each token in the text that is being
    parsed.  ``BottomUpProbabilisticChartParser`` inserts these edges into
    the chart one at a time, starting with the most likely edges, and
    proceeding to less likely edges.  For each edge that is added to
    the chart, it may become possible to insert additional edges into
    the chart; these are added to the queue.  This process continues
    until enough complete parses have been generated, or until the
    queue is empty.

    The sorting order for the queue is not specified by
    ``BottomUpProbabilisticChartParser``.  Different sorting orders will
    result in different search strategies.  The sorting order for the
    queue is defined by the method ``sort_queue``; subclasses are required
    to provide a definition for this method.

    :type _grammar: PCFG
    :ivar _grammar: The grammar used to parse sentences.
    :type _trace: int
    :ivar _trace: The level of tracing output that should be generated
        when parsing a text.
    """
    beam_size: Incomplete
    def __init__(self, grammar, beam_size: int = 0, trace: int = 0) -> None:
        """
        Create a new ``BottomUpProbabilisticChartParser``, that uses
        ``grammar`` to parse texts.

        :type grammar: PCFG
        :param grammar: The grammar used to parse texts.
        :type beam_size: int
        :param beam_size: The maximum length for the parser's edge queue.
        :type trace: int
        :param trace: The level of tracing that should be used when
            parsing a text.  ``0`` will generate no tracing output;
            and higher numbers will produce more verbose tracing
            output.
        """
    def grammar(self): ...
    def trace(self, trace: int = 2) -> None:
        """
        Set the level of tracing output that should be generated when
        parsing a text.

        :type trace: int
        :param trace: The trace level.  A trace level of ``0`` will
            generate no tracing output; and higher trace levels will
            produce more verbose tracing output.
        :rtype: None
        """
    def parse(self, tokens): ...
    def sort_queue(self, queue, chart) -> None:
        """
        Sort the given queue of ``Edge`` objects, placing the edge that should
        be tried first at the beginning of the queue.  This method
        will be called after each ``Edge`` is added to the queue.

        :param queue: The queue of ``Edge`` objects to sort.  Each edge in
            this queue is an edge that could be added to the chart by
            the fundamental rule; but that has not yet been added.
        :type queue: list(Edge)
        :param chart: The chart being used to parse the text.  This
            chart can be used to provide extra information for sorting
            the queue.
        :type chart: Chart
        :rtype: None
        """

class InsideChartParser(BottomUpProbabilisticChartParser):
    '''
    A bottom-up parser for ``PCFG`` grammars that tries edges in descending
    order of the inside probabilities of their trees.  The "inside
    probability" of a tree is simply the
    probability of the entire tree, ignoring its context.  In
    particular, the inside probability of a tree generated by
    production *p* with children *c[1], c[2], ..., c[n]* is
    *P(p)P(c[1])P(c[2])...P(c[n])*; and the inside
    probability of a token is 1 if it is present in the text, and 0 if
    it is absent.

    This sorting order results in a type of lowest-cost-first search
    strategy.
    '''
    def sort_queue(self, queue, chart):
        """
        Sort the given queue of edges, in descending order of the
        inside probabilities of the edges' trees.

        :param queue: The queue of ``Edge`` objects to sort.  Each edge in
            this queue is an edge that could be added to the chart by
            the fundamental rule; but that has not yet been added.
        :type queue: list(Edge)
        :param chart: The chart being used to parse the text.  This
            chart can be used to provide extra information for sorting
            the queue.
        :type chart: Chart
        :rtype: None
        """

class RandomChartParser(BottomUpProbabilisticChartParser):
    """
    A bottom-up parser for ``PCFG`` grammars that tries edges in random order.
    This sorting order results in a random search strategy.
    """
    def sort_queue(self, queue, chart) -> None: ...

class UnsortedChartParser(BottomUpProbabilisticChartParser):
    """
    A bottom-up parser for ``PCFG`` grammars that tries edges in whatever order.
    """
    def sort_queue(self, queue, chart) -> None: ...

class LongestChartParser(BottomUpProbabilisticChartParser):
    """
    A bottom-up parser for ``PCFG`` grammars that tries longer edges before
    shorter ones.  This sorting order results in a type of best-first
    search strategy.
    """
    def sort_queue(self, queue, chart): ...

def demo(choice: Incomplete | None = None, draw_parses: Incomplete | None = None, print_parses: Incomplete | None = None):
    """
    A demonstration of the probabilistic parsers.  The user is
    prompted to select which demo to run, and how many parses should
    be found; and then each parser is run on the same demo, and a
    summary of the results are displayed.
    """

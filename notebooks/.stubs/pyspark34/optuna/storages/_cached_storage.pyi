import optuna
from _typeshed import Incomplete
from optuna import distributions as distributions
from optuna._study_direction import StudyDirection as StudyDirection
from optuna._study_summary import StudySummary as StudySummary
from optuna.storages import BaseStorage as BaseStorage
from optuna.storages._rdb.storage import RDBStorage as RDBStorage
from optuna.trial import FrozenTrial as FrozenTrial, TrialState as TrialState
from typing import Any, Callable, Dict, List, Sequence, Tuple

class _TrialUpdate:
    state: Incomplete
    values: Incomplete
    intermediate_values: Incomplete
    user_attrs: Incomplete
    system_attrs: Incomplete
    params: Incomplete
    distributions: Incomplete
    datetime_complete: Incomplete
    datetime_start: Incomplete
    def __init__(self) -> None: ...

class _StudyInfo:
    trials: Incomplete
    owned_or_finished_trial_ids: Incomplete
    updates: Incomplete
    param_distribution: Incomplete
    directions: Incomplete
    name: Incomplete
    def __init__(self) -> None: ...

class _CachedStorage(BaseStorage):
    """A wrapper class of storage backends.

    This class is used in :func:`~optuna.get_storage` function and automatically
    wraps :class:`~optuna.storages.RDBStorage` class.

    Args:
        storage:
            :class:`~optuna.storages.BaseStorage` class instance to wrap.
    """
    def __init__(self, backend: RDBStorage) -> None: ...
    def create_new_study(self, study_name: str | None = None) -> int: ...
    def delete_study(self, study_id: int) -> None: ...
    def set_study_directions(self, study_id: int, directions: Sequence[StudyDirection]) -> None: ...
    def set_study_user_attr(self, study_id: int, key: str, value: Any) -> None: ...
    def set_study_system_attr(self, study_id: int, key: str, value: Any) -> None: ...
    def get_study_id_from_name(self, study_name: str) -> int: ...
    def get_study_id_from_trial_id(self, trial_id: int) -> int: ...
    def get_study_name_from_id(self, study_id: int) -> str: ...
    def get_study_directions(self, study_id: int) -> List[StudyDirection]: ...
    def get_study_user_attrs(self, study_id: int) -> Dict[str, Any]: ...
    def get_study_system_attrs(self, study_id: int) -> Dict[str, Any]: ...
    def get_all_study_summaries(self) -> List[StudySummary]: ...
    def create_new_trial(self, study_id: int, template_trial: FrozenTrial | None = None) -> int: ...
    def set_trial_state(self, trial_id: int, state: TrialState) -> bool: ...
    def set_trial_param(self, trial_id: int, param_name: str, param_value_internal: float, distribution: distributions.BaseDistribution) -> None: ...
    def get_trial_id_from_study_id_trial_number(self, study_id: int, trial_number: int) -> int: ...
    def get_trial_number_from_id(self, trial_id: int) -> int: ...
    def get_best_trial(self, study_id: int) -> FrozenTrial: ...
    def get_trial_param(self, trial_id: int, param_name: str) -> float: ...
    def set_trial_values(self, trial_id: int, values: Sequence[float]) -> None: ...
    def set_trial_intermediate_value(self, trial_id: int, step: int, intermediate_value: float) -> None: ...
    def set_trial_user_attr(self, trial_id: int, key: str, value: Any) -> None: ...
    def set_trial_system_attr(self, trial_id: int, key: str, value: Any) -> None: ...
    def get_trial(self, trial_id: int) -> FrozenTrial: ...
    def get_all_trials(self, study_id: int, deepcopy: bool = True, states: Tuple[TrialState, ...] | None = None) -> List[FrozenTrial]: ...
    def read_trials_from_remote_storage(self, study_id: int) -> None: ...
    def record_heartbeat(self, trial_id: int) -> None: ...
    def fail_stale_trials(self, study_id: int) -> List[int]: ...
    def get_heartbeat_interval(self) -> int | None: ...
    def get_failed_trial_callback(self) -> Callable[[optuna.Study, FrozenTrial], None] | None: ...

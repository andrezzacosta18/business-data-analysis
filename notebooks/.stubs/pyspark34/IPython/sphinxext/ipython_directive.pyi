from IPython import InteractiveShell as InteractiveShell
from IPython.core.profiledir import ProfileDir as ProfileDir
from _typeshed import Incomplete
from docutils.parsers.rst import Directive

use_matplotlib: bool
COMMENT: Incomplete
INPUT: Incomplete
OUTPUT: Incomplete
PSEUDO_DECORATORS: Incomplete

def block_parser(part, rgxin, rgxout, fmtin, fmtout):
    """
    part is a string of ipython text, comprised of at most one
    input, one output, comments, and blank lines.  The block parser
    parses the text into a list of::

      blocks = [ (TOKEN0, data0), (TOKEN1, data1), ...]

    where TOKEN is one of [COMMENT | INPUT | OUTPUT ] and
    data is, depending on the type of token::

      COMMENT : the comment string

      INPUT: the (DECORATOR, INPUT_LINE, REST) where
         DECORATOR: the input decorator (or None)
         INPUT_LINE: the input as string (possibly multi-line)
         REST : any stdout generated by the input line (not OUTPUT)

      OUTPUT: the output string, possibly multi-line

    """

class EmbeddedSphinxShell:
    """An embedded IPython instance to run inside Sphinx"""
    cout: Incomplete
    IP: Incomplete
    user_ns: Incomplete
    user_global_ns: Incomplete
    input: str
    output: str
    tmp_profile_dir: Incomplete
    is_verbatim: bool
    is_doctest: bool
    is_suppress: bool
    directive: Incomplete
    def __init__(self, exec_lines: Incomplete | None = None) -> None: ...
    def cleanup(self) -> None: ...
    def clear_cout(self) -> None: ...
    def process_input_line(self, line, store_history): ...
    def process_input_lines(self, lines, store_history: bool = True) -> None:
        """process the input, capturing stdout"""
    def process_image(self, decorator):
        """
        # build out an image directive like
        # .. image:: somefile.png
        #    :width 4in
        #
        # from an input like
        # savefig somefile.png width=4in
        """
    def process_input(self, data, input_prompt, lineno):
        """
        Process data block for INPUT token.

        """
    def process_output(self, data, output_prompt, input_lines, output, is_doctest, decorator, image_file):
        """
        Process data block for OUTPUT token.

        """
    def process_comment(self, data):
        """Process data fPblock for COMMENT token."""
    def save_image(self, image_file) -> None:
        """
        Saves the image file to disk.
        """
    def process_block(self, block):
        """
        process block from the block_parser and return a list of processed lines
        """
    def ensure_pyplot(self) -> None:
        """
        Ensures that pyplot has been imported into the embedded IPython shell.

        Also, makes sure to set the backend appropriately if not set already.

        """
    def process_pure_python(self, content):
        """
        content is a list of strings. it is unedited directive content

        This runs it line by line in the InteractiveShell, prepends
        prompts as needed capturing stderr and stdout, then returns
        the content as a list as if it were ipython code
        """
    def custom_doctest(self, decorator, input_lines, found, submitted) -> None:
        """
        Perform a specialized doctest.

        """

class IPythonDirective(Directive):
    has_content: bool
    required_arguments: int
    optional_arguments: int
    final_argumuent_whitespace: bool
    option_spec: Incomplete
    shell: Incomplete
    seen_docs: Incomplete
    def get_config_options(self): ...
    def setup(self): ...
    def teardown(self) -> None: ...
    content: Incomplete
    def run(self): ...

def setup(app): ...
def test() -> None: ...

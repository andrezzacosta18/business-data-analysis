import abc
import socket
from .web_app import Application
from .web_server import Server
from abc import ABC, abstractmethod
from ssl import SSLContext
from typing import Any, List, Set

__all__ = ['BaseSite', 'TCPSite', 'UnixSite', 'NamedPipeSite', 'SockSite', 'BaseRunner', 'AppRunner', 'ServerRunner', 'GracefulExit']

SSLContext = object

class GracefulExit(SystemExit):
    code: int

class BaseSite(ABC, metaclass=abc.ABCMeta):
    def __init__(self, runner: BaseRunner, *, shutdown_timeout: float = 60.0, ssl_context: SSLContext | None = None, backlog: int = 128) -> None: ...
    @property
    @abstractmethod
    def name(self) -> str: ...
    @abstractmethod
    async def start(self) -> None: ...
    async def stop(self) -> None: ...

class TCPSite(BaseSite):
    def __init__(self, runner: BaseRunner, host: str | None = None, port: int | None = None, *, shutdown_timeout: float = 60.0, ssl_context: SSLContext | None = None, backlog: int = 128, reuse_address: bool | None = None, reuse_port: bool | None = None) -> None: ...
    @property
    def name(self) -> str: ...
    async def start(self) -> None: ...

class UnixSite(BaseSite):
    def __init__(self, runner: BaseRunner, path: str, *, shutdown_timeout: float = 60.0, ssl_context: SSLContext | None = None, backlog: int = 128) -> None: ...
    @property
    def name(self) -> str: ...
    async def start(self) -> None: ...

class NamedPipeSite(BaseSite):
    def __init__(self, runner: BaseRunner, path: str, *, shutdown_timeout: float = 60.0) -> None: ...
    @property
    def name(self) -> str: ...
    async def start(self) -> None: ...

class SockSite(BaseSite):
    def __init__(self, runner: BaseRunner, sock: socket.socket, *, shutdown_timeout: float = 60.0, ssl_context: SSLContext | None = None, backlog: int = 128) -> None: ...
    @property
    def name(self) -> str: ...
    async def start(self) -> None: ...

class BaseRunner(ABC, metaclass=abc.ABCMeta):
    def __init__(self, *, handle_signals: bool = False, **kwargs: Any) -> None: ...
    @property
    def server(self) -> Server | None: ...
    @property
    def addresses(self) -> List[Any]: ...
    @property
    def sites(self) -> Set[BaseSite]: ...
    async def setup(self) -> None: ...
    @abstractmethod
    async def shutdown(self) -> None: ...
    async def cleanup(self) -> None: ...

class ServerRunner(BaseRunner):
    """Low-level web server runner"""
    def __init__(self, web_server: Server, *, handle_signals: bool = False, **kwargs: Any) -> None: ...
    async def shutdown(self) -> None: ...

class AppRunner(BaseRunner):
    """Web Application runner"""
    def __init__(self, app: Application, *, handle_signals: bool = False, **kwargs: Any) -> None: ...
    @property
    def app(self) -> Application: ...
    async def shutdown(self) -> None: ...

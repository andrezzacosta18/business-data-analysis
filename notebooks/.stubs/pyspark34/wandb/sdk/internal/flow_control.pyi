from .settings_static import SettingsStatic as SettingsStatic
from _typeshed import Incomplete
from dataclasses import dataclass
from typing import Callable
from wandb.proto.wandb_internal_pb2 import Record as Record
from wandb.sdk.lib import fsm as fsm

logger: Incomplete
DEFAULT_THRESHOLD: Incomplete

@dataclass
class StateContext:
    last_forwarded_offset: int = ...
    last_sent_offset: int = ...
    last_written_offset: int = ...
    def __init__(self, last_forwarded_offset, last_sent_offset, last_written_offset) -> None: ...

class FlowControl:
    def __init__(self, settings: SettingsStatic, forward_record: Callable[[Record], None], write_record: Callable[[Record], int], pause_marker: Callable[[], None], recover_records: Callable[[int, int], None], _threshold_bytes_high: int = 0, _threshold_bytes_mid: int = 0, _threshold_bytes_low: int = 0) -> None: ...
    def flush(self) -> None: ...
    def flow(self, record: Record) -> None: ...

class StateShared:
    def __init__(self) -> None: ...
    def on_exit(self, record: Record) -> StateContext: ...
    def on_enter(self, record: Record, context: StateContext) -> None: ...

class StateForwarding(StateShared):
    def __init__(self, forward_record: Callable[[Record], None], pause_marker: Callable[[], None], threshold_pause: int) -> None: ...
    def on_check(self, record: Record) -> None: ...

class StatePausing(StateShared):
    def __init__(self, forward_record: Callable[[Record], None], recover_records: Callable[[int, int], None], threshold_recover: int, threshold_forward: int) -> None: ...
    def on_check(self, record: Record) -> None: ...
